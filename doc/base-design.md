# 目的
人狼ゲーム「わかめてサーバ」において、自動化されたツールを提供することにより、盤面把握を確実化する。
（把握漏れによる凡ミスを防ぎ、村の知識レベルを底支えする）

* メイン画面をわかめてサーバ http://jinrou.dip.jp/~jinrou/ 上の村とする。
* サイドバーを用いて、わかめてサーバと同じ画面に別ペインを得る。

# 機能

* わかめてサーバからのデータ取得
    * 村のログとして、表示画面のペイロードを得て、サイドバーに送信する。  
      ログ更新直後が望ましいが、わかめてサーバのCGI仕様上厳しそうなので、pollingで済ませる。
    * 注意として、表示系・操作系はいじらない。わかめてサーバは各種の不便さを特徴とするため。
* サイドバーの機能  
  サイドバーは ３領域＋α の画面として提供する。サイドバーを広げることは難しい事情に配慮するもの。
    * 自由メモの領域
    * 発言状況サマリー＆推理入力  
        * 村人数 × 日付 の表を準備する。
        * 各村人について、その日ごとに発言数を表示する。
        * 各村人について、推理情報を入力させる。推理情報の入力観点は「役職CO」「能力結果CO」の他「人外推理」を入力させる。
        * クリックにより、以下「まとめ情報表示」の表示切り替えを行うトリガーを準備する。
    * まとめ情報表示  
      下記３つの機能について、同一の領域で切り替え表示を行う。切り替え操作は上記。
        * 村の状況（推理状況）を表示する。
        * 実際の発言内容を、日付別/キャラ別で表示する。
        * 投票結果まとめを表示する。
    * α：固定領域として、ツール利用に必要な入力画面やリンクを提供する。

# 各機能の具体的設計

## 固定領域：わかめてサーバへのリンク

フレームなし版 http://jinrou.dip.jp/~jinrou/index2.html へのリンクを提供する。（フレームあり版だと .js の埋め込みがうまくいかないことがある）

## 固定領域：配役情報入力フィールド

配役（{auto-calc}人）： 村{auto-calc}占[x]狩[x]霊[x]共[x]猫[x] 狼[x]狂[x] 狐[x]子[x]

x は手入力とする。村の人数とGMの意向によって陣営が変わることがあるので、１日目夜にシステムがGM名義で宣言する配役は信用しない。
具体的に、GM操作（村人・占い師との夜会話）により、背徳者を実現するケースがある。背徳者はシステムの宣言では「村人」で確定するが、本ツールでの取り扱いは「子狐」が望ましい。

ユーザマニュアルを提供する際は以下の注意事項を記載する。

* 全ての役職を入力した後、村人の人数が正しいことを確認してください。
* 大狼は、本ツールでは人狼として扱ってください。初日占い師を考慮する以上、「占い師の●」と「人狼か否か」はツール上リンクしません。
* 背徳者は、本ツールでは子狐として扱ってください。子狐の能力は本ツールに影響を与えません。
* 本ツールは、*猫又の蘇生能力には対応していません*。
* 本ツールは、*デビルトリガーには対応していません*。

## 自由メモ

* 機能 ： ユーザによる自由記載
* 機能 ： 他機能からのデータ取り込み
* 非機能：できるだけたくさんメモを取れるようにする。  
    * 他機能に影響がない範囲で欄を広く取る。
    * フォントサイズに留意する。可能な限り小さく。

## 発言状況サマリー＆推理入力

* 機能：ログの自動取り込み・保存・サマリー表示
* 機能：COおよび推理の基本パラメータ入力
* 機能：まとめ情報表示の切り替えボタン提供（形状はボタンでなくともよい）
* 非機能：ログのディスク保存（web localStorage）＠ブラウザクラッシュ対策
* 非機能：入力したCOと推理の自動保存（web localStorage）＠ブラウザクラッシュ対策
* 機能除外：デスノ持ちCO。

|*状況* *投票*|*１日目*                            |||*2日目*                          |||...|*N日目*    |||...|
|------------|--------|-------------|--------------|--------|------------|------------|---|---|---|-----|---|
|icon *Name* |Comments|[deduced Job]|[Monster Mark]|Comments|[Job-target]|[Job-result]|...|Dead Reason|||   |
|icon *Name* |Comments|[deduced Job]|[Monster Mark]|Comments|[Job-target]|[Job-result]|...|...|...|...  |...|

※注意点１：上記キャラクターには初日犠牲者を含めること。役欠けを考察したいため。変な忖度しなければ問題なし。  

村人名のセルは以下のとおりとする。上の方が優先度高い。

| 色     | 意味 |
|--------|-------------------------------|
| Red    | 死　亡                         |
| Black  | 人外推定（役職COに関わらず）、または、１名以上の占い師から● |
| White  | 人外推定なし、かつ、（役職CO、または、１名以上の占い師から○）|
| Gray   | 人外推定なし、かつ、役職COなし、かつ、占い師からの占い履歴なし|

* *状況* 推理内容まとめに切り替えるボタン。
* *投票* 投票結果まとめに切り替えるボタン。
* *<日付>日目* 発言まとめに切り替えるボタン。  
  同日昼および前日夜の、全キャラの発言を表示する。
  わかめての仕様に合わせ、１日目だけ全角としてもよい。
* *Name* 発言まとめに切り替えるボタン。  
  該当のキャラについて、全ての発言を表示する。
* Comments 発言数  
* [deduced Job]：以下から選択入力。デフォルトは「村　人」。  
　「村　人」「占い師」「狩　人」「霊能者」「共有者」「猫　又」
  Remark：「村　人」でない場合、グレーには反映されない。
* [Monster Mark]：以下から選択。デフォルトは「村　人」。  
　「村　人」「人　外」「人　狼」「狂　人」「妖　狐」「子　狐」 
  Remark：「村　人」でない場合、グレーには反映されない。
* [Job-target] / [Job-result]   
  下表のとおりとする。

| deduced Job | Job-target | Job-result |
|--------|-----------------|-------------|
|「村　人」<br>「共有者」<br>「猫　又」|なし|なし|
|「占い師」|選択：自分以外の生存者|選択：「○」「●」|
|「霊能者」|固定：前日の吊り先|選択：「○」「●」「△」（※）|
|「狩　人」|選択：自分以外の生存者|固定：前日の噛み先（全員、改行で表示）|

※△は子狐専用に提供するが、大狼●が見づらければ使いまわしてもよい。ツール利用者に委ねる。

コーディングの注意事項：  
　★２回死んでいるケースがあるので、翌日昼のログから都度除外する★。この操作で以下仕様を実現する。
* 吊りは夜時間のログを参照する。（翌日昼のログを参照すると狂う）
* 噛み＆デスノは昼時間のログを参照する。
* 突然死は以下。わかめての仕様を確認。
    * （昼）投票失敗のケース　：夜時間のログを参照する。
    * （夜）能力未発動のケース：昼時間のログを参照する。

## まとめ表示

### 推理内容まとめ

* 機能：推理をまとめたものを表示する。
* 機能：まとめをクリックしたとき、まとめ全体を自由メモにコピーする。

考え方：
1. 各役職CO者を明らかにする。
1. 各役職者の視点グレーおよび、占い師の視点の完全グレーを明らかにする。
　　　※視点グレーは霊能者を含む。
1. 各役職および各人外に「人数」を記載する。
1. 「人外」は役職COの考察を含めて記載する。（飽和の確認用）

考えないもの：
1. 共有者のペアは管理しない。
1. デスノ持ちの推理は入力・推論しない。デスノ死体はまとめる。
1. 猫又による蘇生は考えない。

（表示例：x=CO者/推理先、y=定員）※基本的に、村役職はx=>y、人外はx<=yになるはず。
```
　【占い師 (x/y)】※deduced Jobによる判定。ただしMonster Markにより人外判定した場合は、ここに表示しない。
　　ｘ：ｙ●→ｚ○→...
　　　（視点グレー：生存者のうち、占っていない人。CO者は色を変える）
　　ｙ：ｚ○→ｕ○→...
　　　（視点グレー）
　【霊能者 (x/y)】
　　ｚ：ａ○→ｂ○→...
　　ｕ：ａ○→ｂ○→...
　　　（視点グレー：生存者。CO者は色を変える）
　【共有者 (x/y)】
　　ｃ，ｄ
　【猫　又 (x/y)】
　　ｆ，ｇ
　【狩　人 (x/y)】
　　ｈ：ｘ→ｘ→...
　　ｉ：ｙ→ｙ→...
　【生存者 (x/y)】
　【完グレ】
　　（生存者のうち、COせず、また誰からも占われていない人）
　【人　狼 (x/y)】※Monster Markによる判定。y=配役から。中身の書式は人外と同じ。
　【狂　人 (x/y)】※同上
　【妖　狐 (x/y)】※同上
　【子　狐 (x/y)】※同上
　【人　外 (x/y)】※Monster Markにより人外判定された各役職は、deduced Jobに記載したCO役職と結果も記載する。
　　（占い師：(y-x)名）...（狩　人：(y-x)名）
　　ｊ＠偽占い師：ｄ●
　　ｋ
　　　※人外のyは、全人外のy合計から、全人外のx合計を引いたものとする。
　　　※人外のxは、CO者として表示された数の総和＋推理された人外者数の合計とする。
　【吊　り (x)】
　【噛　み (x)】
　【デスノ (x)】
```

### 投票結果まとめ

 * 機能：投票結果のサマリー表示。
 * 機能：クリックした投票結果を自由メモにコピーする

|----|２日目の投票結果                     |...|
|----|-----------------------------------|---|
|Name|vote target<br>(target voted count)|...|
|Name|vote target<br>(target voted count)|...|

コーディングの注意事項：n日目（n>=2）の投票結果は、n日目夜のデータから取得する。
                       （(n+1)日目昼のデータからも取得可能ではある。n日目昼はNG。）

### 発言内容まとめ

* 機能：ログの表示  
    * 日付別
    * キャラ別
* 機能 ： クリックしたログを自由メモにコピーする

# 参考

* 人狼わかめてメモ http://zumi.la.coocan.jp/jinro/wakamete.php
* Instant Wakamemo https://greasyfork.org/ja/scripts/35295-instant-wakamemo

