# 目的
人狼ゲーム「わかめてサーバ」において、自動化されたツールを提供することにより、盤面把握を確実化する。
（把握漏れによる凡ミスを防ぎ、村の知識レベルを底支えする）

* メイン画面をわかめてサーバ http://jinrou.dip.jp/~jinrou/ 上の村とする。
* サイドバーを用いて、わかめてサーバと同じ画面に別ペインを得る。

# 機能

* わかめてサーバからのデータ取得
    * 村のログとして、表示画面のペイロードを得て、サイドバーに送信する。  
      ログ更新直後が望ましいが、わかめてサーバのCGI仕様上厳しそうなので、pollingで済ませる。
    * 注意として、表示系・操作系はいじらない。わかめてサーバは各種の不便さを特徴とするため。
* サイドバーの機能
    * 各種情報およびツールの提供
        * 自由メモ
    * 発言状況サマリー＆推理入力  
        * 実際の発言内容を、日付別/キャラ別でpopupできるようにする。
        * 投票結果まとめをpopupできるようにする。
    * 推理まとめ表示
     * サイドバー画面に関する制限および対応  
        * サイドバーが狭いことから、ペインを３つ以下に抑えたい。
        * 発言状況サマリー機能と、配役および推理情報の入力 は同一画面で実施する

# 各機能の具体的設計

## 自由メモ

* 機能：ユーザによる自由記載
* 機能Advanced ： 他機能からのデータ取り込み。
* 非機能：できるだけたくさんメモを取れるようにする。  
    * 他機能に影響がない範囲で欄を広く取る。
    * フォントサイズに留意する。可能な限り小さく。

## 発言状況サマリー＆推理入力

* 機能：ログの自動取り込み・保存・サマリー表示
* 機能：配役の入力
* 機能：COおよび推理の基本パラメータ入力
* 機能：ログ表示popupへの誘導
* 機能：投票結果popupへの誘導
* 非機能：ログのディスク保存（web localStorage）＠ブラウザクラッシュ対策
* 非機能：入力したCOと推理の自動保存（web localStorage）＠ブラウザクラッシュ対策

配役（{auto-calc}人）： 村{auto-calc}占[x]狩[x]霊[x]共[x]猫[x] 狼[x]狂[x] 狐[x]背[x]

|村人リスト                 |１日目 *昼*/*夜*                             |2日目 *昼*/*投票*/*夜*                   |...|N日目 *昼*/*投票*/*夜*|...|
|--------------------------|-------------------------------------------|----------------------------------------|---|----------------------|---|
|icon<br>Name<br>*Comments*|[deduced Job]<br>[Monster Mark]<br>Comments|[Job-target]<br>[Job-result]<br>Comments|...|Dead Result           |   |
|icon<br>Name<br>*Comments*|[deduced Job]<br>[Monster Mark]<br>Comments|[Job-target]<br>[Job-result]<br>Comments|...|...                   |...|

[] = 入力欄  
イタリック = ポップアップへのリンク  
※注意点１：上記キャラクターには初日犠牲者を含めること。役欠けを考察したいため。変な忖度しなければ問題なし。  
※注意点２：なぜか１日目だけ全角。わかめての仕様である。

* comments 発言数  
* deduced Job：以下から選択。デフォルトは「村　人」。  
　「村　人」「占い師」「狩　人」「霊能者」「共有者」「猫　又」
* Monster Mark：以下から選択。デフォルトは「村　人」。  
　「村　人」「人　外」「人　狼」「狂　人」「妖　狐」「背徳者」  
  Remark：「村　人」でない場合、グレーには反映されない。
* Job-target / Job-Result
　「村　人」「共有者」「猫　又」targetなし、Resultなし。
　「占い師」target入力＠キャラ名、    result入力＠「○」「●」から選択。
　「霊能者」target固定（前日の吊り）、result入力＠「○」「●」から選択。
　「狩　人」target入力＠キャラ名、    result固定（前日の噛み全員）。

Advanced：セルの色の設計（村人名のセル）。上の方が優先度高い。

| 色     | 意味 |
|--------|-------------------------------|
| Red    | 死　亡                       |
| White  | 全ての占い師から○              |
| Yellow | １名以上の占い師から○ （●なし） |
| Gray   | 占い師からの占い先になっていない                |
| Blue   | １名以上の占い師から○、かつ、１名以上の占い師から● |
| Black  | １名以上の占い師から● （○なし）|

コーディングの注意事項：  
　★２回死んでいるケースがあるので、翌日昼のログから都度除外する★。この操作で以下仕様を実現する。
* 吊りは夜時間のログを参照する。（翌日昼のログを参照すると狂う）
* 噛み＆デスノは昼時間のログを参照する。
* 突然死は以下。わかめての仕様を確認。
    * （昼）投票失敗のケース　：夜時間のログを参照する。
    * （夜）能力未発動のケース：昼時間のログを参照する。

## 推理まとめ表示

機能：推理をまとめたものを表示する。
機能Advanced：まとめをクリックしたとき、まとめ全体を自由メモにコピーする。

考え方：
1. 各役職CO者を明らかにする。
1. 各役職者の視点グレーおよび、占い師の視点の完全グレーを明らかにする。
　　　※視点グレーは霊能者を含む。
1. 各役職および各人外に「人数」を記載する。
1. 「人外」は役職COの考察を含めて記載する。（飽和の確認用）

考えないもの：
1. 共有者のペアは管理しない。
1. デスノまわりの推理データは入力・推論しない。
1. （まだできないだけ）猫又による蘇生はまだ考えない。

（表示例：x=CO者/推理先、y=定員）※基本的に、村役職はx=>y、人外はx<=yになるはず。
```
　【占い師 (x/y)】※deduced Jobによる判定。ただしMonster Markにより人外判定した場合は、ここに表示しない。
　　ｘ：ｙ●→ｚ○→...
　　　（視点グレー：生存者のうち、占っていない人。CO者は色を変える）
　　ｙ：ｚ○→ｕ○→...
　　　（視点グレー）
　【霊能者 (x/y)】
　　ｚ：ａ○→ｂ○→...
　　ｕ：ａ○→ｂ○→...
　　　（視点グレー：生存者。CO者は色を変える）
　【共有者 (x/y)】
　　ｃ，ｄ
　【猫　又 (x/y)】
　　ｆ，ｇ
　【狩　人 (x/y)】
　　ｈ：ｘ→ｘ→...
　　ｉ：ｙ→ｙ→...
　【生存者 (x/y)】
　【完グレ】
　　（生存者のうち、COせず、また誰からも占われていない人）
　【人　狼 (x/y)】※Monster Markによる判定。y=配役から。中身の書式は人外と同じ。
　【狂　人 (x/y)】※同上
　【妖　狐 (x/y)】※同上
　【背徳者 (x/y)】※同上
　【人　外 (x/y)】※Monster Markにより人外判定された各役職は、deduced Jobに記載したCO役職と結果も記載する。
　　（占い師：(y-x)名）...（狩　人：(y-x)名）
　　ｊ＠偽占い師：ｄ●
　　ｋ
　　　※人外のyは、全人外のy合計から、全人外のx合計を引いたものとする。
　　　※人外のxは、CO者として表示された数の総和＋推理された人外者数の合計とする。
```

## 投票結果まとめpopup

 * 機能：投票結果のサマリー表示。
 * 機能 Advanced：クリックした日の投票結果を自由メモにコピーする
 * 機能 Advanced：ログ表示popupへのリンク（キャラ別のみ）

|--------------|２日目の投票結果                     |...|
|--------------|-----------------------------------|---|
|icon<br>*Name*|vote target<br>(target voted count)|...|
|icon<br>*Name*|vote target<br>(target voted count)|...|

コーディングの注意事項：n日目（n>=2）の投票結果は、n日目夜のデータから取得する。
                       （(n+1)日目昼のデータからも取得可能ではある。n日目昼はNG。）

T.B.D. （複数回投票のケースの、データ形式および表示形式）

## ログ表示popup

* 機能：リンクで指定されたログの表示。  
    * 日付別。  
    * キャラ別。  
        * （日付別 × キャラ別の両方絞りは不要）
    * 機能 Advanced ： クリックしたログを自由メモにコピーする

# 参考

* 人狼わかめてメモ http://zumi.la.coocan.jp/jinro/wakamete.php
* Instant Wakamemo https://greasyfork.org/ja/scripts/35295-instant-wakamemo

